<!DOCTYPE html>
<html lang="en">
<head>
<title>ACE Editor</title>
<link rel="stylesheet" href="/css/bootstrap.4.4.1.min.css">
<style type="text/css" media="screen">
    #editor { 
        position: absolute;
        top: 3.2em;
        right: 0;
        bottom: 4em;
        left: 0;
    }
    #errorInfo { padding: 0.1rem; color: red}
</style>
</head>
<body>
    <div>
        <button class="btn btn-warning btn-sm mr-1" onClick="parent.document._iFrameBridge.close();">Cancel</button>
        <span id="errorInfo"></span>
    </div>
    <div id="editor"></div>
    

</body>
</html>
<script src="/js/ace/src-min/ace.js" crossorigin="anonymous"></script>
<script>
    var editor = ace.edit("editor");
    editor.getSession().setMode("ace/mode/json");
    editor.setTheme("ace/theme/twilight");

    function save(editor) {
        let valid = (Object.keys(editor.getSession().getAnnotations()).length === 0) ? true : false;
        if (valid) {
            parent.document._iFrameBridge.save(editor.getValue())
        }
    }
    function validationMessage(editor) {
        if (Object.keys(editor.getSession().getAnnotations()).length === 0) {
           document.getElementById('errorInfo').innerHTML = '<button class="btn btn-warning btn-sm" onClick="save(editor);">Save</button>';
        } else {
            document.getElementById('errorInfo').innerHTML = 'Incorrect JSON Format!';
        }
    }

    editor.session.on('change', function(delta) {
    });

    editor.session.on("changeAnnotation", function() {
        validationMessage(editor);
    })

    parent.document._iFrameBridge.loadContents(function(data) {
        editor.session.setValue(data);
    });
</script>